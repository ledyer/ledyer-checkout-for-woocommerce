!function(e){var i={};function n(o){if(i[o])return i[o].exports;var r=i[o]={i:o,l:!1,exports:{}};return e[o].call(r.exports,r,r.exports,n),r.l=!0,r.exports}n.m=e,n.c=i,n.d=function(e,i,o){n.o(e,i)||Object.defineProperty(e,i,{enumerable:!0,get:o})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,i){if(1&i&&(e=n(e)),8&i)return e;if(4&i&&"object"==typeof e&&e&&e.__esModule)return e;var o=Object.create(null);if(n.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:e}),2&i&&"string"!=typeof e)for(var r in e)n.d(o,r,function(i){return e[i]}.bind(null,r));return o},n.n=function(e){var i=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(i,"a",i),i},n.o=function(e,i){return Object.prototype.hasOwnProperty.call(e,i)},n.p="/content/plugins/ledyer-checkout-for-woocommerce/build/",n(n.s=0)}([function(e,n){jQuery((function(e){if("undefined"==typeof lco_params)return!1;var n={bodyEl:e("body"),checkoutFormSelector:e("form.checkout"),paymentMethodEl:e('input[name="payment_method"]'),paymentMethod:"",selectAnotherSelector:"#ledyer-checkout-select-other",shippingUpdated:!1,blocked:!1,preventPaymentMethodChange:!1,timeout:null,interval:null,ledyerUpdateNeeded:!1,shippingEmailExists:!1,shippingPhoneExists:!1,shippingFirstNameExists:!1,shippingLastNameExists:!1,documentReady:function(){0<n.paymentMethodEl.length?n.paymentMethod=n.paymentMethodEl.filter(":checked").val():n.paymentMethod="lco","lco"===n.paymentMethod&&e("#ship-to-different-address-checkbox").prop("checked",!0),lco_params.pay_for_order||n.moveExtraCheckoutFields()},lcoSuspend:function(){window.ledyer&&window.ledyer.api.suspend()},lcoResume:function(){window.ledyer&&window.ledyer.api.resume()},changeFromLco:function(i){i.preventDefault(),e(n.checkoutFormSelector).block({message:null,overlayCSS:{background:"#fff",opacity:.6}}),e.ajax({type:"POST",dataType:"json",data:{lco:!1,nonce:lco_params.change_payment_method_nonce},url:lco_params.change_payment_method_url,success:function(e){},error:function(e){},complete:function(e){window.location.href=e.responseJSON.data.redirect}})},maybeChangeToLco:function(){n.preventPaymentMethodChange||"lco"===e(this).val()&&(e(".woocommerce-info").remove(),e(n.checkoutFormSelector).block({message:null,overlayCSS:{background:"#fff",opacity:.6}}),e.ajax({type:"POST",data:{lco:!0,nonce:lco_params.change_payment_method_nonce},dataType:"json",url:lco_params.change_payment_method_url,success:function(e){},error:function(e){},complete:function(e){window.location.href=e.responseJSON.data.redirect}}))},moveExtraCheckoutFields:function(){document.querySelectorAll("#order_comments_field").length>1&&document.querySelector("#order_comments_field").remove(),e(".woocommerce-additional-fields").appendTo("#lco-extra-checkout-fields");var o=e('form[name="checkout"] input, form[name="checkout"] select, textarea'),r=!1;for(i=0;i<o.length;i++){var t=o[i].name.replace("[]","\\[\\]");e("table.woocommerce-checkout-review-order-table").find(o[i]).length||-1===e.inArray(t,lco_params.standard_woo_checkout_fields)&&("wc_checkout_add_ons"===e("p#"+t+"_field").parent().attr("id")?r||(r=!0,e("div#wc_checkout_add_ons").appendTo("#lco-extra-checkout-fields")):0<e("p#"+t+"_field").length?("shipping_phone"===t&&(n.shippingPhoneExists=!0),"shipping_email"===t&&(n.shippingEmailExists=!0),"shipping_first_name"===t&&(n.shippingFirstNameExists=!0),"shipping_last_name"===t&&(n.shippingLastNameExists=!0),e("p#"+t+"_field").appendTo("#lco-extra-checkout-fields")):e('input[name="'+t+'"]').closest("p").appendTo("#lco-extra-checkout-fields"))}},updateCart:function(){n.lcoSuspend(!0),e.ajax({type:"POST",url:lco_params.update_cart_url,data:{checkout:n.cleanupForm(e("form.checkout")),nonce:lco_params.update_cart_nonce},dataType:"json",success:function(e){},error:function(e){},complete:function(i){e("body").trigger("update_checkout"),n.lcoResume()}})},getLedyerOrder:function(){return n.preventPaymentMethodChange=!0,e(".woocommerce-checkout-review-order-table").block({message:null,overlayCSS:{background:"#fff",opacity:.6}}),e.ajax({type:"POST",url:lco_params.get_ledyer_order_url,data:{nonce:lco_params.get_ledyer_order_nonce},dataType:"json",success:function(i){n.setCustomerData(i.data),0<e("form.checkout #terms").length&&e("form.checkout #terms").prop("checked",!0)},error:function(e){},complete:function(e){}})},setCustomerData:function(i){"billing_address"in i&&null!==i.billing_address&&("billing_first_name"in i.billing_address&&e("#billing_first_name").val(i.billing_address.billing_first_name),"billing_last_name"in i.billing_address&&e("#billing_last_name").val(i.billing_address.billing_last_name),"billing_company"in i.billing_address&&e("#billing_company").val(i.billing_address.billing_company),"billing_address_1"in i.billing_address&&e("#billing_address_1").val(i.billing_address.billing_address_1),"billing_address_2"in i.billing_address&&e("#billing_address_2").val(i.billing_address.billing_address_2),"billing_city"in i.billing_address&&e("#billing_city").val(i.billing_address.billing_city),"billing_postcode"in i.billing_address&&e("#billing_postcode").val(i.billing_address.billing_postcode),"billing_phone"in i.billing_address&&e("#billing_phone").val(i.billing_address.billing_phone),"billing_email"in i.billing_address&&e("#billing_email").val(i.billing_address.billing_email),"billing_country"in i.billing_address&&e("#billing_country").val(i.billing_address.billing_country.toUpperCase()),"billing_state"in i.billing_address&&e("#billing_state").val(i.billing_address.billing_state),e("#billing_email").change(),e("#billing_email").blur()),"shipping_address"in i&&null!==i.shipping_address&&(e("#ship-to-different-address-checkbox").prop("checked",!0),"shipping_first_name"in i.shipping_address&&e("#shipping_first_name").val(i.shipping_address.shipping_first_name),"shipping_last_name"in i.shipping_address&&e("#shipping_last_name").val(i.shipping_address.shipping_last_name),"shipping_company"in i.shipping_address&&e("#shipping_company").val(i.shipping_address.shipping_company),"shipping_address_1"in i.shipping_address&&e("#shipping_address_1").val(i.shipping_address.shipping_address_1),"shipping_address_2"in i.shipping_address&&e("#shipping_address_2").val(i.shipping_address.shipping_address_2),"shipping_city"in i.shipping_address&&e("#shipping_city").val(i.shipping_address.shipping_city),"shipping_postcode"in i.shipping_address&&e("#shipping_postcode").val(i.shipping_address.shipping_postcode),"shipping_country"in i.shipping_address&&e("#shipping_country").val(i.shipping_address.shipping_country.toUpperCase()),"shipping_state"in i.shipping_address&&e("#shipping_state").val(i.shipping_address.shipping_state),!0===n.shippingEmailExists&&e("#shipping_email")&&e("#shipping_email").val("shipping_email"in i.shipping_address?i.shipping_address.shipping_email:""),!0===n.shippingPhoneExists&&e("#shipping_phone")&&e("#shipping_phone").val("shipping_phone"in i.shipping_address?i.shipping_address.shipping_phone:""),!0===n.shippingFirstNameExists&&e("#shipping_first_name")&&e("#shipping_first_name").val("shipping_first_name"in i.shipping_address?i.shipping_address.shipping_first_name:""),!0===n.shippingLastNameExists&&e("#shipping_last_name")&&e("#shipping_last_name").val("shipping_last_name"in i.shipping_address?i.shipping_address.shipping_last_name:""))},logToFile:function(i){e.ajax({url:lco_params.log_to_file_url,type:"POST",dataType:"json",data:{message:i,nonce:lco_params.log_to_file_nonce}})},log:function(e){lco_params.logging&&console.log(e)},failOrder:function(){var i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"Kunde inte slutföra ordern. Var god försök igen. Om problemet kvarstår, vänligen kontakta kundsupport.",n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;window.ledyer.api.clientValidation({shouldProceed:!1,message:{title:null,body:i}});var o=lco_params.pay_for_order?"div.woocommerce-notices-wrapper":"form.checkout";e("body").trigger("update_checkout");var r=null!=n?n:i,t='<div class="woocommerce-error">'.concat(r,"</div>");e(".woocommerce-NoticeGroup-checkout, .woocommerce-error, .woocommerce-message").remove(),e(o).prepend('<div class="woocommerce-NoticeGroup woocommerce-NoticeGroup-checkout"> '.concat(t," </div>")),e(o).removeClass("processing").unblock(),e(o).find(".input-text, select, input:checkbox").trigger("validate").blur(),e(document.body).trigger("checkout_error",[r]),e("html, body").animate({scrollTop:e(o).offset().top-100},1e3)},cleanupForm:function(i){return i.find("input, select, textarea").filter((function(){return""!==e(this).val()})).serialize()},placeLedyerOrder:function(){var i=arguments.length>0&&void 0!==arguments[0]&&arguments[0];n.blocked=!0,n.getLedyerOrder().done((function(o){o.success?(e(".woocommerce-checkout-review-order-table").block({message:null,overlayCSS:{background:"#fff",opacity:.6}}),sessionStorage.removeItem("ledyerWooRedirectUrl"),e.ajax({type:"POST",url:lco_params.submit_order,data:n.cleanupForm(e("form.checkout")),dataType:"json",success:function(e){try{if("success"!==e.result)throw"Result failed";n.logToFile("Successfully created order in WooCommerce.");var o=new URL(e.redirect);if(sessionStorage.setItem("ledyerWooRedirectUrl",o),i)return void window.ledyer.api.clientValidation({shouldProceed:!0});window.location.href=o.toString()}catch(i){e.messages?(n.logToFile("Checkout error | "+e.messages),n.failOrder("Vänligen kontrollera att alla uppgifter är korrekt ifyllda.",e.messages)):(n.logToFile("Checkout error | No message"+i),n.failOrder())}},error:function(e){try{n.logToFile("AJAX error | "+JSON.stringify(e))}catch(e){n.logToFile("AJAX error | Failed to parse error message.")}n.failOrder()}})):(n.logToFile("Failed to get the order from Ledyer."),n.failOrder())}))},init:function(){e(document).ready(n.documentReady),0<e("form.checkout #terms").length&&e("form.checkout #terms").prop("checked",!0),n.bodyEl.on("update_checkout",n.lcoSuspend),n.bodyEl.on("updated_checkout",n.lcoResume),n.bodyEl.on("change","input.qty",n.updateCart),n.bodyEl.on("change",'input[name="payment_method"]',n.maybeChangeToLco),n.bodyEl.on("click",n.selectAnotherSelector,n.changeFromLco),e(document).on("ledyerCheckoutOrderComplete",(function(e){if(n.logToFile("ledyerCheckoutOrderComplete from Ledyer triggered"),!lco_params.pay_for_order){var i=sessionStorage.getItem("ledyerWooRedirectUrl");i&&(window.location.href=i)}})),e(document).on("ledyerCheckoutOrderPending",(function(e){n.logToFile("ledyerCheckoutOrderPending from Ledyer triggered"),lco_params.pay_for_order||n.placeLedyerOrder()})),e(document).on("ledyerCheckoutWaitingForClientValidation",(function(e){n.logToFile("ledyerCheckoutWaitingForClientValidation from Ledyer triggered"),lco_params.pay_for_order?window.ledyer.api.clientValidation({shouldProceed:!0}):n.placeLedyerOrder(!0)}))}};n.init()}))}]);